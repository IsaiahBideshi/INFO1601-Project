<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CinemaScope | Browse</title>
</head>

<!--Code for font-->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dosis:wght@200..800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="../navbar.css">
<link rel="stylesheet" href="browse.css">

<script>
    let allMovies = [{}];
    let currentPage = 1;

    const options = {
        method: 'GET',
        headers: {
            accept: 'application/json',
            Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyYWNkZWEwYWE0NWI0YjQ4NzUwNDBlOTFlYTMyNDMzZiIsIm5iZiI6MTc0MzM1NjI1Ny4wMzQsInN1YiI6IjY3ZTk4MTYxNzAwYTZhOTRjNmU1NjFhMiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ZfUp1LrNIcQ2Q0pIZSYP5P1YgMaksjF50ckc6qoaiBg'
        }
    };

    function drawMovies(movies){
        let moviesArea = document.querySelector("#movies-area");
        let html = ``;
        for(let movie of movies) {
            if (!movie.poster_path) continue;
            html += `
                <a class="movie" href="#">
                    <div class="card">
                        <img src="https://image.tmdb.org/t/p/w500/${movie.poster_path}" alt="${movie.title}" style="width:100%">
                        <div class="container">
                            <h4><b>${movie.title}</b></h4>
                            <p>${movie.release_date.split("-")[0]}</p>
                        </div>
                    </div>
                </a>
            `;
        }
        moviesArea.innerHTML = html;
    }

    async function getMoviesFromPage(page) {
        let response = await fetch(`https://api.themoviedb.org/3/discover/movie?include_adult=false&include_video=false&language=en-US&page=${page}&sort_by=popularity.desc`, options)
        let data = await response.json();

        allMovies[page] = data.results;

        console.log(allMovies);
        drawMovies(data.results);

        // Change both pages buttons to current page number
        document.querySelector(".bottom").innerHTML = `
            <button class="page-button prev-page" onclick="prevPage()">Previous</button>
            <button class="page-button current-page">${page}</button>
            <button class="page-button next-page" onclick="nextPage()">Next</button>`;
        document.querySelector(".top").innerHTML = `
            <button class="page-button prev-page" onclick="prevPage()">Previous</button>
            <button class="page-button current-page">${page}</button>
            <button class="page-button next-page" onclick="nextPage()">Next</button>`;
    }

    function nextPage() {
        currentPage++;
        getMoviesFromPage(currentPage);
    }
    function prevPage() {
        if (currentPage > 1) {
            currentPage--;
            getMoviesFromPage(currentPage);
        }
    }

    getMoviesFromPage(currentPage);
</script>

<body>
    <nav>
        <a href="../index.html" id="logo-button">
            <h1><span style="color: red">Cinema</span>Scope</h1>
        </a>
        <div id="home-area">
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="./Browse/browse.html">Movies</a></li>
                <li><a href="tvshows.html">Shows</a></li>

            </ul>
        </div>

        <div id="search-area">
            <form id="search-form" action="search.html" method="get" style="margin-left: auto">
                <input id="search-field" type="text" name="query" placeholder="Search Movie or TV Show" required>
                <button style="" id="search-btn" type="submit">Search</button>
            </form>
        </div>

        <div id="account-area">
            <ul style="">
                <li><a href="../Log In/login.html">Login</a></li>
                <li><a href="../Sign Up/signup.html">SignUp</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="page-buttons top">
            <button class="page-button prev-page" onclick="prevPage()">Previous</button>
            <button class="page-button current-page">1</button>
            <button class="page-button next-page" onclick="nextPage()">Next</button>
        </div>

        <div id="movies-area">
            <div class="card">
                <img src="https://m.media-amazon.com/images/M/MV5BYzdjMDAxZGItMjI2My00ODA1LTlkNzItOWFjMDU5ZDJlYWY3XkEyXkFqcGc@._V1_SX300.jpg"
                     alt="Avatar" style="width:100%">
                <div class="container">
                    <h4><b>Interstellar</b></h4>
                    <p>2014</p>
                </div>
            </div>
        </div>

        <div class="page-buttons bottom">
            <button class="page-button prev-page" onclick="prevPage()">Previous</button>
            <button class="page-button current-page">1</button>
            <button class="page-button next-page" onclick="nextPage()">Next</button>
        </div>
    </main>
</body>
</html>